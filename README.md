# Лабораторная работа №1 #
## Copyright by **[@Широков Александр](https://github.com/AlexShi23)**, **[@Бодров Егор](https://github.com/EgorBodrov)**

## Вариант №6
### Уровень 1

___

1. Дана схема базы данных в виде следующих отношений. С помощью операторов SQL создать логическую структуру соответствующих таблиц для хранения в СУБД, используя известные средства поддержания целостности (NOT NULL, UNIQUE, и т.д.). Обосновать выбор типов данных и используемые средства поддержания целостности. При выборе подходящих типов данных использовать информацию о конкретных значениях полей БД (см. прил.1).

ПОТРЕБИТЕЛЬ

|ИДЕНТИФИКАТОР|НАЗВАНИЕ|АДРЕС ЖИТЕЛЬСТВА|СКИДКА, %|
|:----:|:----:|:----:|:----:|

ПОСТАВЩИК

|ИДЕНТИФИКАТОР|ФАМИЛИЯ|АДРЕС|КОМИССИОННЫЕ, %|
|:----:|:----:|:----:|:----:|

ЗАКАЗ

|НОМЕР|ДАТА|ПОТРЕБИТЕЛЬ|ПОСТАВЩИК|ДЕТАЛЬ|КОЛ-ВО|СУММА, РУБ|
|:----:|:----:|:----:|:----:|:----:|:----:|:----:|

ДЕТАЛЬ

|ИДЕНТИФИКАТОР|НАИМЕНОВАНИЕ|СКЛАД|КОЛ-ВО|ЦЕНА, РУБ|
|:----:|:----:|:----:|:----:|:----:|


``` SQL

create table "ПОТРЕБИТЕЛЬ" (
    "ИДЕНТИФИКАТОР" serial not null primary key,
    -- Идентификатор serial, не должен быть null. 
    -- Увеличивается с каждым добавлением новой записи
    "НАЗВАНИЕ" varchar(50) not null,
    -- varchar на 50 символов 
    "АДРЕС ЖИТЕЛЬСТВА" varchar(255) not null,
    -- varchar на 255 символов 
    "СКИДКА, %" smallint check ("СКИДКА, %" >= 0 and "СКИДКА, %" <= 100) not null
    -- smallint занимает минимум памяти. check позволяет избежать
    -- ошибок и хранить в данном поле только значения от 0% до 100%
);

create table "ПОСТАВЩИК" (
    "ИДЕНТИФИКАТОР" serial not null primary key,
    -- Идентификатор serial, не должен быть null. 
    -- Увеличивается с каждым добавлением новой записи
    "ФАМИЛИЯ" varchar(50) not null,
    -- varchar на 50 символов 
    "АДРЕС" varchar(255) not null,
    -- varchar на 255 символов 
    "КОММИСИОННЫЕ, %" smallint check ("КОММИСИОННЫЕ, %" >= 0 and "КОММИСИОННЫЕ, %" <= 100) not null
    -- smallint занимает минимум памяти. check позволяет избежать
    -- ошибок и хранить в данном поле только значения от 0% до 100%
);

create table "ДЕТАЛЬ" (
    "ИДЕНТИФИКАТОР" serial not null primary key,
    -- Идентификатор serial, не должен быть null. 
    -- Увеличивается с каждым добавлением новой записи
    "НАИМЕНОВАНИЕ" varchar(50) not null,
    -- varchar на 50 символов 
    "СКЛАД" varchar(255) not null,
    -- varchar на 255 символов 
    "КОЛ-ВО" integer check ("КОЛ-ВО" > 0) not null,
    -- integer, check не даёт поставить отрицательное значение или 0
    "ЦЕНА, РУБ" integer check ("ЦЕНА, РУБ" > 0) not null
    -- integer, check не даёт поставить отрицательное значение или 0
);

create table "ЗАКАЗ" (
    "НОМЕР" serial not null primary key,
    -- Идентификатор serial, не должен быть null. 
    -- Увеличивается с каждым добавлением новой записи
    "ДАТА" varchar(10) not null,
    -- varchar на 10 символов, чтобы уместить дату, например 06.04.2021
    "ПОТРЕБИТЕЛЬ" integer not null references ПОТРЕБИТЕЛЬ (ИДЕНТИФИКАТОР),
    -- связь с таблицей ПОТРЕБИТЕЛЬ и полем ИДЕНТИФИКАТОР
    "ПОСТАВЩИК" integer not null references ПОСТАВЩИК (ИДЕНТИФИКАТОР),
    -- связь с таблицей ПОСТАВЩИК и полем ИДЕНТИФИКАТОР
    "ДЕТАЛЬ" integer not null references ДЕТАЛЬ (ИДЕНТИФИКАТОР),
    -- связь с таблицей ДЕТАЛЬ и полем ИДЕНТИФИКАТОР
    "КОЛ-ВО" integer check ("КОЛ-ВО" >= 0) not null,
    -- integer, check не даёт поставить отрицательное значение или 0
    "СУММА, РУБ" integer check ("СУММА, РУБ" > 0) not null
    -- integer, check не даёт поставить отрицательное значение или 0
);

```
___

2. Ввести в ранее созданные таблицы конкретные данные (см. прил. 1). Использовать скрипт-файл из операторов INSERT или вспомогательную утилиту.

```SQL
insert into "ПОТРЕБИТЕЛЬ" ("ИДЕНТИФИКАТОР", "НАЗВАНИЕ", "АДРЕС ЖИТЕЛЬСТВА", "СКИДКА, %")
values (001, 'АО ВАРЯ', 'Сормовский', 10),
       (002, 'ГАЗ', 'Автозаводский', 7),
       (003, 'МП ВЕРА', 'Канавинский', 5),
       (004, 'МП', 'Канавинский', 3),
       (005, 'АО СТАЛЬ', 'Советский', 0);

insert into "ПОСТАВЩИК" ("ИДЕНТИФИКАТОР", "ФАМИЛИЯ", "АДРЕС", "КОММИСИОННЫЕ, %")
values (001, 'Артюхина', 'Сормовский', 4),
       (002, 'Щепин', 'Приокский', 4),
       (003, 'Власов', 'Канавинский', 5),
       (004, 'Кузнецова', 'Советский', 5),
       (005, 'Цепилева', 'Нижегородский', 3),
       (006, 'Корнилов', 'Нижегородский', 6);

insert into "ДЕТАЛЬ" ("ИДЕНТИФИКАТОР", "НАИМЕНОВАНИЕ", "СКЛАД", "КОЛ-ВО", "ЦЕНА, РУБ")
values (001, 'Втулка', 'Сормовский', 20000, 5000),        
       (002, 'Болт', 'Сормовский', 40000, 1000),
       (003, 'Ключ гаечный', 'Канавинский', 5000, 3000),        
       (004, 'Шпилька', 'Автозаводский', 10000, 900),        
       (005, 'Винт', 'Сормовский', 50000, 1500),   
       (006, 'Молоток', 'Канавинский', 1200, 2000),        
       (007, 'Шуруп', 'Сормовский', 30000, 1200);

insert into "ЗАКАЗ" ("НОМЕР", "ДАТА", "ПОТРЕБИТЕЛЬ", "ПОСТАВЩИК", "ДЕТАЛЬ", "КОЛ-ВО", "СУММА, РУБ")
values (00001, 'Январь', 005, 004, 003, 7, 21000),
       (00002, 'Февраль', 003, 003, 003, 2, 6000),
       (00003, 'Февраль', 004, 005, 004, 200, 180000),
       (00004, 'Март', 005, 004, 002, 50, 50000),
       (00005, 'Апрель', 001, 006, 007,	110, 132000),
       (00006, 'Апрель', 004, 004, 001,	150, 750000),
       (00007, 'Май', 002, 004,	006, 20, 40000),
       (00008, 'Июнь', 001,	003, 007, 2000,	2400000),
       (00009, 'Июнь', 002,	005, 007, 10000, 12000000),
       (00010, 'Июнь', 003,	006, 001, 5, 25000),
       (00011, 'Июнь', 004,	003, 003, 1, 3000),
       (00012, 'Июнь', 004,	004, 001, 10, 50000),
       (00013, 'Июль', 001,	006, 006, 3, 6000),
       (00014, 'Июль', 002,	001, 002, 1000,	1000000),
       (00015, 'Июль', 002,	002, 001, 100, 5000000),
       (00016, 'Июль', 005,	001, 005, 100, 15000),
       (00017, 'Август', 001, 004, 007, 12000, 24400000);
```
___


3. Используя оператор SELECT создать запрос для вывода всех строк каждой таблицы. Проверить правильность ввода. При необходимости произвести коррекцию значений операторами INSERT, UPDATE, DELETE.

```SQL
select * from "ПОТРЕБИТЕЛЬ";
```
![image](https://user-images.githubusercontent.com/63846736/113744730-a4315e80-970d-11eb-8034-bcea87fa407d.png)

```SQL
select * from "ПОСТАВЩИК";
```
![1](https://user-images.githubusercontent.com/63846736/113744955-d80c8400-970d-11eb-83ca-dd1585961dee.PNG)


```SQL
select * from "ДЕТАЛЬ";
```
![image](https://user-images.githubusercontent.com/63846736/113745313-f96d7000-970d-11eb-8242-cb8fac3cb05d.png)

```SQL
select * from "ЗАКАЗ";
```
![image](https://user-images.githubusercontent.com/63846736/113745588-143fe480-970e-11eb-87d9-cd11e84dd187.png)

___

4. Создать запросы для вывода:

a) всех различных размеров комиссионных;

```SQL
select distinct "КОММИСИОННЫЕ, %" FROM "ПОСТАВЩИК";
```
![image](https://user-images.githubusercontent.com/63846736/113745888-62ed7e80-970e-11eb-9bf9-c0650f72f6f4.png)

b) всех различных фамилий поставщиков;

```SQL
select distinct "ФАМИЛИЯ" FROM "ПОСТАВЩИК";
```
![image](https://user-images.githubusercontent.com/63846736/113745924-6bde5000-970e-11eb-965b-3498e39838a6.png)

c) всех различных наименований деталей.

```SQL
select distinct "НАИМЕНОВАНИЕ" FROM "ДЕТАЛЬ";
```
![image](https://user-images.githubusercontent.com/63846736/113745953-74368b00-970e-11eb-93cd-d186bf1b03e4.png)

___

5. Создав запрос получить следующую информацию:

a) фамилии и адреса поставщиков, имеющих размер комиссионных менее 5%;

```SQL
select "ФАМИЛИЯ", "АДРЕС" from "ПОСТАВЩИК" where "КОММИСИОННЫЕ, %" < 5;
```
![image](https://user-images.githubusercontent.com/63846736/113750989-173dd380-9714-11eb-844f-93bd3cee4c2b.png)


b) название и адрес склада для деталей, находящихся в количесиве менее 1500 шт.;

```SQL
select "СКЛАД" from "ДЕТАЛЬ" where "КОЛ-ВО" < 1500;
```
![image](https://user-images.githubusercontent.com/63846736/113751000-1efd7800-9714-11eb-8005-4ad31b6b49d8.png)

c) название, адрес и размер скидки для предприятий, имеющих в названии слово “МП”. Отсортировать по адресу и размеру скидки.

```SQL
select "НАЗВАНИЕ", "АДРЕС ЖИТЕЛЬСТВА", "СКИДКА, %" from "ПОТРЕБИТЕЛЬ" where "НАЗВАНИЕ" like '%МП%';
```
![image](https://user-images.githubusercontent.com/63846736/113751035-2886e000-9714-11eb-94bb-4f6555091ec4.png)

___

6. На основании данных о заказах вывести все данные в таком формате:

a) номер, дата фамилия поставщика, сумма заказа. Отсортировать по фамилиям и сумме заказа;

```SQL
select "ЗАКАЗ"."НОМЕР", "ЗАКАЗ"."ДАТА", "ПОСТАВЩИК"."ФАМИЛИЯ", "ЗАКАЗ"."СУММА, РУБ"
from "ЗАКАЗ", "ПОСТАВЩИК"
where "ЗАКАЗ"."ПОСТАВЩИК" = "ПОСТАВЩИК"."ИДЕНТИФИКАТОР"
order by "ПОСТАВЩИК"."ФАМИЛИЯ", "ЗАКАЗ"."СУММА, РУБ";
```
![image](https://user-images.githubusercontent.com/63846736/113751182-50764380-9714-11eb-9472-8a5a3ff1d712.png)

b) название детали, количество, дата.

```SQL
select "ДЕТАЛЬ"."НАИМЕНОВАНИЕ", "ЗАКАЗ"."КОЛ-ВО", "ЗАКАЗ"."ДАТА"
from "ЗАКАЗ", "ДЕТАЛЬ"
where "ДЕТАЛЬ"."ИДЕНТИФИКАТОР" = "ЗАКАЗ"."ДЕТАЛЬ"
```
![image](https://user-images.githubusercontent.com/63846736/113751463-a64aeb80-9714-11eb-9d84-c1e7c16beb2b.png)

___

7. Вывести:

a) названия и размер скидки организаций-потребителей, куда поставлял детали Щепин, а общая сумма заказа превышала 5000;

```SQL
select "НАЗВАНИЕ", "СКИДКА, %" from "ПОТРЕБИТЕЛЬ" where "ИДЕНТИФИКАТОР" = 
(select "ПОТРЕБИТЕЛЬ" from "ЗАКАЗ" where "ПОСТАВЩИК" = 
(select "ИДЕНТИФИКАТОР" from "ПОСТАВЩИК" where "ФАМИЛИЯ" = 'Щепин') and "СУММА, РУБ" > 5000);
```
![image](https://user-images.githubusercontent.com/13623013/114315083-f277a080-9b05-11eb-9b62-0b4ec3635d4a.png)


b) фамилии и размер комиссионных для поставщиков, поставлявших детали предприятиям чужих районов не ранее января. Отсортировать по возрастанию комиссионных;

```SQL
select distinct "ФАМИЛИЯ", "КОММИСИОННЫЕ, %" from ЗАКАЗ
join ПОСТАВЩИК on ЗАКАЗ.ПОСТАВЩИК = ПОСТАВЩИК.ИДЕНТИФИКАТОР 
join ПОТРЕБИТЕЛЬ on ЗАКАЗ.ПОТРЕБИТЕЛЬ = ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР
where "АДРЕС" != "АДРЕС ЖИТЕЛЬСТВА" and "ДАТА" != 'Январь' and "ДАТА" != 'Февраль'
order by "КОММИСИОННЫЕ, %"
```
![image](https://user-images.githubusercontent.com/13623013/114315101-03c0ad00-9b06-11eb-903a-7baf8b401365.png)

c) название и оставшееся количество деталей, заказывавшихся в количестве более 2 штук предприятиями Автозаводского и Советского районов. В вывод добавить суммарную стоимость соответствующих заказов;

```SQL
select ДЕТАЛЬ.НАИМЕНОВАНИЕ, ДЕТАЛЬ."КОЛ-ВО" as "ОСТАВШЕЕСЯ КОЛ-ВО", ЗАКАЗ."СУММА, РУБ" from ДЕТАЛЬ
join ЗАКАЗ on ЗАКАЗ.ДЕТАЛЬ = ДЕТАЛЬ.ИДЕНТИФИКАТОР
join ПОТРЕБИТЕЛЬ on ЗАКАЗ.ПОТРЕБИТЕЛЬ = ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР
where ЗАКАЗ."КОЛ-ВО" > 2 and (ПОТРЕБИТЕЛЬ."АДРЕС ЖИТЕЛЬСТВА" = 'Автозаводский' or ПОТРЕБИТЕЛЬ."АДРЕС ЖИТЕЛЬСТВА" = 'Советский')
```
![image](https://user-images.githubusercontent.com/13623013/114315118-12a75f80-9b06-11eb-8b71-3020a27ab340.png)

d) названия предприятий одного района, заказывавших молотки.

```SQL
select ПОТРЕБИТЕЛЬ.НАЗВАНИЕ from ЗАКАЗ 
join ПОТРЕБИТЕЛЬ on ЗАКАЗ.ПОТРЕБИТЕЛЬ = ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР
join ДЕТАЛЬ on ЗАКАЗ.ДЕТАЛЬ = ДЕТАЛЬ.ИДЕНТИФИКАТОР
where ДЕТАЛЬ.НАИМЕНОВАНИЕ = 'Молоток'
group by ПОТРЕБИТЕЛЬ."АДРЕС ЖИТЕЛЬСТВА", ПОТРЕБИТЕЛЬ.НАЗВАНИЕ having count(*) > 1
```
![image](https://user-images.githubusercontent.com/13623013/114315126-1f2bb800-9b06-11eb-9586-0a77e8a9f671.png)

___

8. Создать запрос для модификации всех значений столбца с суммарной величиной платы, чтобы он содержал истинную сумму, которую заплатил потребитель ( с учетом скидки). Вывести новые значения.

```SQL
update "ЗАКАЗ"
set "СУММА, РУБ" = "СУММА, РУБ" - "СУММА, РУБ" * "ПОТРЕБИТЕЛЬ"."СКИДКА, %" / 100 from "ПОТРЕБИТЕЛЬ"
where "ЗАКАЗ"."ПОТРЕБИТЕЛЬ" = "ПОТРЕБИТЕЛЬ"."ИДЕНТИФИКАТОР";
select "СУММА, РУБ" from "ЗАКАЗ";
```
![image](https://user-images.githubusercontent.com/63846736/113756713-6850c600-971a-11eb-86af-7d0e79023d99.png)

___

9. Расширить таблицу с данными о заказах столбцом, содержащим величину комиссионных поставщика. Создать запрос для ввода конкретных значений во все строки таблицы.

```SQL
alter table "ЗАКАЗ"
add "КОММИСИОННЫЕ, %" smallint null;
update "ЗАКАЗ"
set "КОММИСИОННЫЕ, %" = "ПОСТАВЩИК"."КОММИСИОННЫЕ, %" from "ПОСТАВЩИК"
where "ЗАКАЗ"."ПОСТАВЩИК" = "ПОСТАВЩИК"."ИДЕНТИФИКАТОР";
select "КОММИСИОННЫЕ, %" from "ЗАКАЗ";
```
![image](https://user-images.githubusercontent.com/63846736/113758159-33457300-971c-11eb-87c1-590613b2c71b.png)

___


### Уровень 2

10. Используя операцию IN (NOT IN) реализовать следующие запросы:

a) найти всех потребителей, заказывавших болты или винты не менее двух раз;
```SQL
select distinct "НАЗВАНИЕ" from "ПОТРЕБИТЕЛЬ"
where "ИДЕНТИФИКАТОР" in (
  select distinct "ПОТРЕБИТЕЛЬ" from "ЗАКАЗ" 
  where "ДЕТАЛЬ" in (
    select "ИДЕНТИФИКАТОР" from "ДЕТАЛЬ"
    where "НАИМЕНОВАНИЕ" in ('Болт', 'Винт')
  ) and "КОЛ-ВО" >= 2
);
```
![image](https://user-images.githubusercontent.com/63846736/114089825-4ba1c300-98bf-11eb-86b6-130fd0d56674.png)

b) найти потребителей, не делавших заказов на сумму менее 50000руб. поставщикам из своего района ;
```SQL
-- В задании говорится о сумме в полмиллиона, однако в таком случае, результат будет пустым отношением, заменили значение на 50 тысяч!
select distinct "НАЗВАНИЕ" from "ПОТРЕБИТЕЛЬ"
where "ИДЕНТИФИКАТОР" in (
  select distinct "ЗАКАЗ"."ПОТРЕБИТЕЛЬ" from "ЗАКАЗ", "ПОТРЕБИТЕЛЬ", "ПОСТАВЩИК" 
  where "ПОСТАВЩИК"."ИДЕНТИФИКАТОР" = "ЗАКАЗ"."ПОСТАВЩИК"
  and "ПОТРЕБИТЕЛЬ"."ИДЕНТИФИКАТОР" = "ЗАКАЗ"."ПОТРЕБИТЕЛЬ"
  and "ПОТРЕБИТЕЛЬ"."АДРЕС ЖИТЕЛЬСТВА" = "ПОСТАВЩИК"."АДРЕС"
  and "ЗАКАЗ"."СУММА, РУБ" >= 50000
);
```
![image](https://user-images.githubusercontent.com/63846736/114093284-96253e80-98c3-11eb-9138-b8cedde94b90.png)

c) запросы задания 7.с и 7.d.

7.c название и оставшееся количество деталей, заказывавшихся в количестве более 2 штук предприятиями Автозаводского и Советского районов. В вывод добавить суммарную стоимость соответствующих заказов;
``` SQL
select ДЕТАЛЬ."НАИМЕНОВАНИЕ", ДЕТАЛЬ."КОЛ-ВО" as "ОСТАВШЕЕСЯ КОЛ-ВО", ЗАКАЗ."СУММА, РУБ" from "ДЕТАЛЬ"
join ЗАКАЗ on ЗАКАЗ.ДЕТАЛЬ = ДЕТАЛЬ.ИДЕНТИФИКАТОР
  where "ПОТРЕБИТЕЛЬ" in (
    select "ИДЕНТИФИКАТОР" from "ПОТРЕБИТЕЛЬ"
    where "АДРЕС ЖИТЕЛЬСТВА" in ('Автозаводский', 'Советский')
  ) and ЗАКАЗ."КОЛ-ВО" > 2
```

7.d названия предприятий одного района, заказывавших молотки.
``` SQL
select distinct "НАЗВАНИЕ" from "ПОТРЕБИТЕЛЬ"
where "ИДЕНТИФИКАТОР" in (
  select "ЗАКАЗ"."ПОТРЕБИТЕЛЬ" from "ЗАКАЗ"
  where "ДЕТАЛЬ" in (
  select "ДЕТАЛЬ"."ИДЕНТИФИКАТОР" from "ДЕТАЛЬ" where "НАИМЕНОВАНИЕ" in ('Молоток'))
)
group by ПОТРЕБИТЕЛЬ."АДРЕС ЖИТЕЛЬСТВА", ПОТРЕБИТЕЛЬ.НАЗВАНИЕ having count(*) > 1
```
___

11. Используя операции ALL-ANY реализовать следующие запросы:

a) найти поставщика с наименьшими комиссионными, который в мае поставлял детали потребителю, сделавшему заказ максимальной стоимости в апреле;
``` SQL
select "ФАМИЛИЯ", "КОММИСИОННЫЕ, %"
from "ПОСТАВЩИК"
where "ИДЕНТИФИКАТОР" = (
  select "ПОСТАВЩИК"
  from "ЗАКАЗ"
  where "ПОТРЕБИТЕЛЬ" = (
     select "ПОТРЕБИТЕЛЬ"
     from "ЗАКАЗ"
     where "СУММА, РУБ" >= all (
       select "СУММА, РУБ"
       from "ЗАКАЗ"
       where "ДАТА" = 'Апрель'
     ) and "ДАТА" = 'Апрель'
  ) and "ДАТА" = 'Май' limit 1
)
```
![image](https://user-images.githubusercontent.com/63846736/114314337-db837f00-9b02-11eb-8b1e-08442adf6ada.png)


b) найти деталь у которой цена совпадает с ценой какой-либо ( но не той же самой) детали, проданной поставщиком из Советского района с максимальными комиссионными;
```SQL
select "НАИМЕНОВАНИЕ"
from "ДЕТАЛЬ"
where "ИДЕНТИФИКАТОР" = any (
  select "ДЕТАЛЬ"
  from "ЗАКАЗ"
  where "ПОСТАВЩИК" = (
    select "ИДЕНТИФИКАТОР" 
    from "ПОСТАВЩИК"
    where "АДРЕС" = 'Советский' and "КОММИСИОННЫЕ, %" >= all (
      select "КОММИСИОННЫЕ, %"
      from "ПОСТАВЩИК"
      where "АДРЕС" = 'Советский'
    ) limit 1
  ) 
  group by (select "СУММА, РУБ" / "КОЛ-ВО"), "ДЕТАЛЬ"
  having count(*) > 1
);
```
![image](https://user-images.githubusercontent.com/63846736/114318544-235fd180-9b16-11eb-9466-e11d588a6d31.png)

c) найти потребителя, который имеет не максимальный размер скидки и покупал детали у поставщиков из Канавинского района;
```SQL
select "НАЗВАНИЕ" 
from "ПОТРЕБИТЕЛЬ"
where "ИДЕНТИФИКАТОР" = any (
  select distinct "ПОТРЕБИТЕЛЬ" 
  from "ЗАКАЗ"
  where "ПОТРЕБИТЕЛЬ" in (
    select "ИДЕНТИФИКАТОР" 
    from "ПОТРЕБИТЕЛЬ"
    where "СКИДКА, %" < all (
      select max("СКИДКА, %")
      from "ПОТРЕБИТЕЛЬ"
    )
  ) and "ПОСТАВЩИК" = any (
    select "ИДЕНТИФИКАТОР"    
    from "ПОСТАВЩИК"
    where "АДРЕС" = 'Канавинский'
  )
);
```
![image](https://user-images.githubusercontent.com/63846736/114318558-34a8de00-9b16-11eb-91d8-cc4b91a124d4.png)

d) запрос задания 7.а.
```SQL
select "НАЗВАНИЕ", "СКИДКА, %" 
from "ПОТРЕБИТЕЛЬ"
where "ИДЕНТИФИКАТОР" = any (
  select "ПОТРЕБИТЕЛЬ" from "ЗАКАЗ" 
  where "ПОСТАВЩИК" = any (
    select "ИДЕНТИФИКАТОР" from "ПОСТАВЩИК"
    where "ФАМИЛИЯ" = 'Щепин'
  )
  and "СУММА, РУБ" > 5000
);
```
![image](https://user-images.githubusercontent.com/63846736/114318573-438f9080-9b16-11eb-89fa-ce996f487abc.png)

___

12. Используя операцию UNION получить места складирования деталей и места расположения поставщиков.

```SQL
select СКЛАД
from ДЕТАЛЬ
union
select АДРЕС
from ПОСТАВЩИК
```
![image](https://user-images.githubusercontent.com/13623013/114320247-bea87500-9b1d-11eb-91b2-f4fada17edd0.png)

___

13. Используя операцию EXISTS ( NOT EXISTS ) реализовать нижеследующие запросы. В случае, если для текущего состояния БД запрос будет выдавать пустое множество строк, требуется указать какие добавления в БД необходимо провести.

a) определить потребителей, заказывавших детали с ценой более 6000руб. у всех поставщиков из Советского или Канавинского районов;
``` SQL
select ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР, ПОТРЕБИТЕЛЬ.НАЗВАНИЕ from ЗАКАЗ, ПОСТАВЩИК, ПОТРЕБИТЕЛЬ, ДЕТАЛЬ
where ПОСТАВЩИК = ПОСТАВЩИК.ИДЕНТИФИКАТОР 
and ПОТРЕБИТЕЛЬ = ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР
and ДЕТАЛЬ = ДЕТАЛЬ.ИДЕНТИФИКАТОР
and exists (select "ЦЕНА, РУБ" from ДЕТАЛЬ
where "ЦЕНА, РУБ" > 6000)
and ПОСТАВЩИК."АДРЕС" in ('Советский', 'Канавинский');

insert into ДЕТАЛЬ (ИДЕНТИФИКАТОР, НАИМЕНОВАНИЕ, СКЛАД, "КОЛ-ВО", "ЦЕНА, РУБ") values (008, 'Гайка', 'Сормовский', 20000, 8000);
insert into ЗАКАЗ ("НОМЕР", "ДАТА", "ПОТРЕБИТЕЛЬ", "ПОСТАВЩИК", "ДЕТАЛЬ", "КОЛ-ВО", "СУММА, РУБ") values (000018, 'Январь',  002, 003, 008, 10, 40000);

select ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР, ПОТРЕБИТЕЛЬ.НАЗВАНИЕ from ЗАКАЗ, ПОСТАВЩИК, ПОТРЕБИТЕЛЬ, ДЕТАЛЬ
where ПОСТАВЩИК = ПОСТАВЩИК.ИДЕНТИФИКАТОР 
and ПОТРЕБИТЕЛЬ = ПОТРЕБИТЕЛЬ.ИДЕНТИФИКАТОР
and ДЕТАЛЬ = ДЕТАЛЬ.ИДЕНТИФИКАТОР
and "ЦЕНА, РУБ" > 6000
and ПОСТАВЩИК."АДРЕС" in ('Советский', 'Канавинский');
```
![image](https://user-images.githubusercontent.com/13623013/114320310-121ac300-9b1e-11eb-9719-6d27bd3684a5.png)


b) найти деталь, которую заказывали в количестве одной штуки все потребители;

c) какие детали не заказывали потребители с размером скидки менее 5%;

d) найти потребителя, заказывавшего все детали, не поставляемые поставщиками из Сормовского района.

```SQL

```
___

14. Реализовать запросы с использованием аггрегатных функций:

a) определить суммарную стоимость всех заказов, произведенных потребителями из Канавинского района;

b) найти среднее число заказываемых деталей со ценой более 2000;

c) найти максимальную скидку среди потребителей, заказывавших детали у поставщиков из своего района;

d) какие детали имеют цену за штуку меньше средней.

```SQL

```
___

15. Используя средства группировки реализовать следующие запросы:

a) найти для каждой пары “потребитель-поставщик” суммарную величину стоимости произведенных заказов;

b) найти детали, которые более трех раз заказывали потребители из Советского района;

c) найти месяц, в котором все заказы имели стоимость не менее 10000;

d) получить для каждой детали со ценой более 10000 среднее количество заказываемых деталей.


